package hardware_test

import (
	"testing"

	"github.com/onsi/gomega"

	"github.com/aws/eks-anywhere/pkg/providers/tinkerbell/hardware"
)

func TestValidMachine(t *testing.T) {
	g := gomega.NewWithT(t)

	machine := hardware.Machine{
		ID:           "unique string",
		IPAddress:    "10.10.10.10",
		Gateway:      "10.10.10.1",
		Nameservers:  []string{"nameserver1"},
		Netmask:      "255.255.255.255",
		MACAddress:   "00:00:00:00:00:00",
		Hostname:     "localhost",
		BMCIPAddress: "10.10.10.11",
		BMCUsername:  "username",
		BMCPassword:  "password",
		BMCVendor:    "dell",
	}

	err := machine.Validate()

	g.Expect(err).ToNot(gomega.HaveOccurred())
}

func TestInvalidMachine(t *testing.T) {
	g := gomega.NewWithT(t)

	cases := map[string]hardware.Machine{
		"EmptyID": {
			ID:           "",
			IPAddress:    "10.10.10.10",
			Gateway:      "10.10.10.1",
			Nameservers:  []string{"nameserver1"},
			Netmask:      "255.255.255.255",
			MACAddress:   "00:00:00:00:00:00",
			Hostname:     "localhost",
			BMCIPAddress: "10.10.10.11",
			BMCUsername:  "username",
			BMCPassword:  "password",
			BMCVendor:    "dell",
		},
		"EmptyIPAddress": {
			ID:           "unique string",
			IPAddress:    "",
			Gateway:      "10.10.10.1",
			Nameservers:  []string{"nameserver1"},
			Netmask:      "255.255.255.255",
			MACAddress:   "00:00:00:00:00:00",
			Hostname:     "localhost",
			BMCIPAddress: "10.10.10.11",
			BMCUsername:  "username",
			BMCPassword:  "password",
			BMCVendor:    "dell",
		},
		"InvalidIPAddress": {
			ID:           "unique string",
			IPAddress:    "invalid",
			Gateway:      "10.10.10.1",
			Nameservers:  []string{"nameserver1"},
			Netmask:      "255.255.255.255",
			MACAddress:   "00:00:00:00:00:00",
			Hostname:     "localhost",
			BMCIPAddress: "10.10.10.11",
			BMCUsername:  "username",
			BMCPassword:  "password",
			BMCVendor:    "dell",
		},
		"EmptyGateway": {
			ID:           "unique string",
			IPAddress:    "10.10.10.10",
			Gateway:      "",
			Nameservers:  []string{"nameserver1"},
			Netmask:      "255.255.255.255",
			MACAddress:   "00:00:00:00:00:00",
			Hostname:     "localhost",
			BMCIPAddress: "10.10.10.11",
			BMCUsername:  "username",
			BMCPassword:  "password",
			BMCVendor:    "dell",
		},
		"InvalidGateway": {
			ID:           "unique string",
			IPAddress:    "10.10.10.10",
			Gateway:      "invalid",
			Nameservers:  []string{"nameserver1"},
			Netmask:      "255.255.255.255",
			MACAddress:   "00:00:00:00:00:00",
			Hostname:     "localhost",
			BMCIPAddress: "10.10.10.11",
			BMCUsername:  "username",
			BMCPassword:  "password",
			BMCVendor:    "dell",
		},
		"NoNameservers": {
			ID:           "unique string",
			IPAddress:    "10.10.10.10",
			Gateway:      "10.10.10.1",
			Nameservers:  []string{},
			Netmask:      "255.255.255.255",
			MACAddress:   "00:00:00:00:00:00",
			Hostname:     "localhost",
			BMCIPAddress: "10.10.10.11",
			BMCUsername:  "username",
			BMCPassword:  "password",
			BMCVendor:    "dell",
		},
		"EmptyNameserver": {
			ID:           "unique string",
			IPAddress:    "10.10.10.10",
			Gateway:      "10.10.10.1",
			Nameservers:  []string{""},
			Netmask:      "255.255.255.255",
			MACAddress:   "00:00:00:00:00:00",
			Hostname:     "localhost",
			BMCIPAddress: "10.10.10.11",
			BMCUsername:  "username",
			BMCPassword:  "password",
			BMCVendor:    "dell",
		},
		"EmptyNetmask": {
			ID:           "unique string",
			IPAddress:    "10.10.10.10",
			Gateway:      "10.10.10.1",
			Nameservers:  []string{"nameserver1"},
			Netmask:      "",
			MACAddress:   "00:00:00:00:00:00",
			Hostname:     "localhost",
			BMCIPAddress: "10.10.10.11",
			BMCUsername:  "username",
			BMCPassword:  "password",
			BMCVendor:    "dell",
		},
		"EmptyMACAddress": {
			ID:           "unique string",
			IPAddress:    "10.10.10.10",
			Gateway:      "10.10.10.1",
			Nameservers:  []string{"nameserver1"},
			Netmask:      "255.255.255.255",
			MACAddress:   "",
			Hostname:     "localhost",
			BMCIPAddress: "10.10.10.11",
			BMCUsername:  "username",
			BMCPassword:  "password",
			BMCVendor:    "dell",
		},
		"InvalidMACAddress": {
			ID:           "unique string",
			IPAddress:    "10.10.10.10",
			Gateway:      "10.10.10.1",
			Nameservers:  []string{"nameserver1"},
			Netmask:      "255.255.255.255",
			MACAddress:   "invalid mac",
			Hostname:     "localhost",
			BMCIPAddress: "10.10.10.11",
			BMCUsername:  "username",
			BMCPassword:  "password",
			BMCVendor:    "dell",
		},
		"EmptyHostname": {
			ID:           "unique string",
			IPAddress:    "10.10.10.10",
			Gateway:      "10.10.10.1",
			Nameservers:  []string{"nameserver1"},
			Netmask:      "255.255.255.255",
			MACAddress:   "00:00:00:00:00:00",
			Hostname:     "",
			BMCIPAddress: "10.10.10.11",
			BMCUsername:  "username",
			BMCPassword:  "password",
			BMCVendor:    "dell",
		},
		"InvalidHostname": {
			ID:           "unique string",
			IPAddress:    "10.10.10.10",
			Gateway:      "10.10.10.1",
			Nameservers:  []string{"nameserver1"},
			Netmask:      "255.255.255.255",
			MACAddress:   "00:00:00:00:00:00",
			Hostname:     "!@#$%",
			BMCIPAddress: "10.10.10.11",
			BMCUsername:  "username",
			BMCPassword:  "password",
			BMCVendor:    "dell",
		},
		"EmptyBMCIPAddress": {
			ID:           "unique string",
			IPAddress:    "10.10.10.10",
			Gateway:      "10.10.10.1",
			Nameservers:  []string{"nameserver1"},
			Netmask:      "255.255.255.255",
			MACAddress:   "00:00:00:00:00:00",
			Hostname:     "localhost",
			BMCIPAddress: "",
			BMCUsername:  "username",
			BMCPassword:  "password",
			BMCVendor:    "dell",
		},
		"InvalidBMCIPAddress": {
			ID:           "unique string",
			IPAddress:    "10.10.10.10",
			Gateway:      "10.10.10.1",
			Nameservers:  []string{"nameserver1"},
			Netmask:      "255.255.255.255",
			MACAddress:   "00:00:00:00:00:00",
			Hostname:     "localhost",
			BMCIPAddress: "invalid",
			BMCUsername:  "username",
			BMCPassword:  "password",
			BMCVendor:    "dell",
		},
		"EmptyBMCUsername": {
			ID:           "unique string",
			IPAddress:    "10.10.10.10",
			Gateway:      "10.10.10.1",
			Nameservers:  []string{"nameserver1"},
			Netmask:      "255.255.255.255",
			MACAddress:   "00:00:00:00:00:00",
			Hostname:     "localhost",
			BMCIPAddress: "10.10.10.11",
			BMCUsername:  "",
			BMCPassword:  "password",
			BMCVendor:    "dell",
		},
		"EmptyBMCPassword": {
			ID:           "unique string",
			IPAddress:    "10.10.10.10",
			Gateway:      "10.10.10.1",
			Nameservers:  []string{"nameserver1"},
			Netmask:      "255.255.255.255",
			MACAddress:   "00:00:00:00:00:00",
			Hostname:     "localhost",
			BMCIPAddress: "10.10.10.11",
			BMCUsername:  "username",
			BMCPassword:  "",
			BMCVendor:    "dell",
		},
		"EmptyBMCVendor": {
			ID:           "unique string",
			IPAddress:    "10.10.10.10",
			Gateway:      "10.10.10.1",
			Nameservers:  []string{"nameserver1"},
			Netmask:      "255.255.255.255",
			MACAddress:   "00:00:00:00:00:00",
			Hostname:     "localhost",
			BMCIPAddress: "10.10.10.11",
			BMCUsername:  "username",
			BMCPassword:  "password",
			BMCVendor:    "",
		},
	}

	for name, machine := range cases {
		t.Run(name, func(t *testing.T) {
			err := machine.Validate()
			g.Expect(err).To(gomega.HaveOccurred())
		})
	}
}
