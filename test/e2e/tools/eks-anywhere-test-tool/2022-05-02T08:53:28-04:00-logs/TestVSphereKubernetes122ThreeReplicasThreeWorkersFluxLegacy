2022-05-02T01:57:43.045Z	V4	e2e	Logger init completed	{"vlevel": 4}
=== RUN   TestVSphereKubernetes122ThreeReplicasThreeWorkersFluxLegacy
2022-05-02T01:57:43.045Z	V2	e2e	Pulling docker image	{"image": "public.ecr.aws/l0g8r8j6/eks-anywhere-cli-tools:v0.1.0-eks-a-v0.0.0-dev-build.589"}
2022-05-02T01:57:52.267Z	V3	e2e	Initializing long running container	{"name": "eksa_1651456663045962179", "image": "public.ecr.aws/l0g8r8j6/eks-anywhere-cli-tools:v0.1.0-eks-a-v0.0.0-dev-build.589"}
2022-05-02T01:57:57.062Z	V2	e2e	Pulling docker image	{"image": "public.ecr.aws/l0g8r8j6/eks-anywhere-cli-tools:v0.1.0-eks-a-v0.0.0-dev-build.589"}
2022-05-02T01:57:58.023Z	V3	e2e	Initializing long running container	{"name": "eksa_1651456677061889647", "image": "public.ecr.aws/l0g8r8j6/eks-anywhere-cli-tools:v0.1.0-eks-a-v0.0.0-dev-build.589"}
    cluster.go:499: Running shell command [ eksctl anywhere generate clusterconfig main-i-00ba4edccd69369e5 -p vsphere > cluster.yaml ]
    cluster.go:374: Creating cluster main-i-00ba4edccd69369e5
    cluster.go:499: Running shell command [ eksctl anywhere create cluster -f main-i-00ba4edccd69369e5-config/cluster.yaml -v 4 ]
2022-05-02T01:58:02.512Z	V4	Logger init completed	{"vlevel": 4}
2022-05-02T01:58:02.674Z	V0	Warning: VSphereDatacenterConfig configured in insecure mode
2022-05-02T01:58:02.726Z	V4	Reading bundles manifest	{"url": "https://dev-release-prod-pdx.s3.amazonaws.com/bundle-release.yaml"}
2022-05-02T01:58:02.834Z	V2	Pulling docker image	{"image": "public.ecr.aws/l0g8r8j6/eks-anywhere-cli-tools:v0.7.2-eks-a-v0.0.0-dev-build.1872"}
2022-05-02T01:58:09.504Z	V3	Initializing long running container	{"name": "eksa_1651456682834827268", "image": "public.ecr.aws/l0g8r8j6/eks-anywhere-cli-tools:v0.7.2-eks-a-v0.0.0-dev-build.1872"}
2022-05-02T01:58:12.689Z	V4	Checking validity of Github Access Token environment variable	{"env var": "EKSA_GITHUB_TOKEN"}
2022-05-02T01:58:12.970Z	V0	Checking Github Access Token permissions
2022-05-02T01:58:12.970Z	V0	✅ Github personal access token has the required repo permissions
2022-05-02T01:58:12.970Z	V4	Task start	{"task_name": "setup-validate"}
2022-05-02T01:58:12.970Z	V0	Performing setup and validations
2022-05-02T01:58:12.970Z	V0	Warning: VSphereDatacenterConfig configured in insecure mode
2022-05-02T01:58:12.999Z	V0	✅ Connected to server
2022-05-02T01:58:13.388Z	V0	✅ Authenticated to vSphere
2022-05-02T01:58:13.792Z	V0	✅ Datacenter validated
2022-05-02T01:58:14.108Z	V0	✅ Network validated
2022-05-02T01:58:16.612Z	V0	✅ Datastore validated
2022-05-02T01:58:16.929Z	V0	✅ Folder validated
2022-05-02T01:58:17.277Z	V0	✅ Resource pool validated
2022-05-02T01:58:17.602Z	V0	✅ Datastore validated
2022-05-02T01:58:17.927Z	V0	✅ Folder validated
2022-05-02T01:58:18.299Z	V0	✅ Resource pool validated
2022-05-02T01:58:18.646Z	V0	✅ Datastore validated
2022-05-02T01:58:19.011Z	V0	✅ Folder validated
2022-05-02T01:58:19.337Z	V0	✅ Resource pool validated
2022-05-02T01:58:20.137Z	V0	✅ Control plane and Workload templates validated
2022-05-02T01:58:23.767Z	V0	✅ Vsphere Provider setup is valid
2022-05-02T01:58:23.873Z	V0	✅ Flux path
2022-05-02T01:58:23.873Z	V0	✅ Validate certificate for registry mirror
2022-05-02T01:58:23.873Z	V0	✅ Create preflight validations pass
2022-05-02T01:58:23.873Z	V4	Task finished	{"task_name": "setup-validate", "duration": "10.903208004s"}
2022-05-02T01:58:23.874Z	V4	----------------------------------
2022-05-02T01:58:23.874Z	V4	Task start	{"task_name": "bootstrap-cluster-init"}
2022-05-02T01:58:23.874Z	V0	Creating new bootstrap cluster
2022-05-02T01:58:23.874Z	V4	Creating kind cluster	{"name": "main-i-00ba4edccd69369e5-eks-a-cluster", "kubeconfig": "main-i-00ba4edccd69369e5/generated/main-i-00ba4edccd69369e5.kind.kubeconfig"}
2022-05-02T01:59:20.479Z	V0	Provider specific pre-capi-install-setup on bootstrap cluster
2022-05-02T01:59:20.479Z	V0	Installing cluster-api providers on bootstrap cluster
2022-05-02T02:00:28.697Z	V0	Provider specific post-setup
2022-05-02T02:00:28.697Z	V4	Task finished	{"task_name": "bootstrap-cluster-init", "duration": "2m4.823340103s"}
2022-05-02T02:00:28.697Z	V4	----------------------------------
2022-05-02T02:00:28.697Z	V4	Task start	{"task_name": "workload-cluster-init"}
2022-05-02T02:00:28.697Z	V0	Creating new workload cluster
2022-05-02T02:00:31.406Z	V3	Waiting for external etcd to be ready	{"cluster": "main-i-00ba4edccd69369e5"}
2022-05-02T03:42:36.290Z	V4	Task finished	{"task_name": "workload-cluster-init", "duration": "1h42m7.593219142s"}
2022-05-02T03:42:36.290Z	V4	----------------------------------
2022-05-02T03:42:36.290Z	V4	Task start	{"task_name": "collect-cluster-diagnostics"}
2022-05-02T03:42:36.290Z	V0	collecting cluster diagnostics
2022-05-02T03:42:36.290Z	V0	collecting management cluster diagnostics
2022-05-02T03:42:36.293Z	V3	bundle config written	{"path": "main-i-00ba4edccd69369e5/generated/bootstrap-cluster-2022-05-02T03:42:36Z-bundle.yaml"}
2022-05-02T03:42:36.293Z	V1	creating temporary namespace for diagnostic collector	{"namespace": "eksa-diagnostics"}
2022-05-02T03:42:36.656Z	V1	creating temporary ClusterRole and RoleBinding for diagnostic collector
2022-05-02T03:42:37.364Z	V0	⏳ Collecting support bundle from cluster, this can take a while	{"cluster": "bootstrap-cluster", "bundle": "main-i-00ba4edccd69369e5/generated/bootstrap-cluster-2022-05-02T03:42:36Z-bundle.yaml", "since": "2022-05-02T02:42:36.293Z", "kubeconfig": "main-i-00ba4edccd69369e5/generated/main-i-00ba4edccd69369e5.kind.kubeconfig"}
2022-05-02T03:44:01.713Z	V0	Support bundle archive created	{"path": "support-bundle-2022-05-02T03_42_37.tar.gz"}
2022-05-02T03:44:01.713Z	V0	Analyzing support bundle	{"bundle": "main-i-00ba4edccd69369e5/generated/bootstrap-cluster-2022-05-02T03:42:36Z-bundle.yaml", "archive": "support-bundle-2022-05-02T03_42_37.tar.gz"}
2022-05-02T03:44:02.392Z	V0	Analysis output generated	{"path": "main-i-00ba4edccd69369e5/generated/bootstrap-cluster-2022-05-02T03:44:02Z-analysis.yaml"}
2022-05-02T03:44:02.392Z	V1	cleaning up temporary roles for diagnostic collectors
2022-05-02T03:44:02.884Z	V1	cleaning up temporary namespace  for diagnostic collectors	{"namespace": "eksa-diagnostics"}
2022-05-02T03:44:08.586Z	V0	collecting workload cluster diagnostics
2022-05-02T03:44:08.586Z	V4	Task finished	{"task_name": "collect-cluster-diagnostics", "duration": "1m32.295455044s"}
2022-05-02T03:44:08.586Z	V4	----------------------------------
2022-05-02T03:44:08.586Z	V4	Tasks completed	{"duration": "1h45m55.615365223s"}
2022-05-02T03:44:08.586Z	V3	Logging out from current govc session
2022-05-02T03:44:09.223Z	V3	Cleaning up long running container	{"name": "eksa_1651456682834827268"}
Error: waiting for external etcd for workload cluster to be ready: executing wait: error: timed out waiting for the condition on clusters/main-i-00ba4edccd69369e5

    cluster.go:532: Command eksctl anywhere [create cluster -f main-i-00ba4edccd69369e5-config/cluster.yaml -v 4] failed with error: exit status 255: Error: waiting for external etcd for workload cluster to be ready: executing wait: error: timed out waiting for the condition on clusters/main-i-00ba4edccd69369e5
2022-05-02T03:44:09.339Z	V4	e2e	Checking validity of Github Access Token environment variable	{"env var": "EKSA_GITHUB_TOKEN"}
2022-05-02T03:44:09.638Z	V0	e2e	Checking Github Access Token permissions
2022-05-02T03:44:09.638Z	V0	e2e	✅ Github personal access token has the required repo permissions
2022-05-02T03:44:09.638Z	V3	e2e	Describing Github repository	{"name": "spacecraft-aws-eks-anywhere-test-0bed5a33-d5ad-4e31-9136-7417857631a0-20", "owner": "that-jetpack-guy"}
2022-05-02T03:44:09.638Z	V3	e2e	Describing Github repository	{"name": "spacecraft-aws-eks-anywhere-test-0bed5a33-d5ad-4e31-9136-7417857631a0-20", "owner": "that-jetpack-guy"}
    flux.go:245: Skipped repo deletion: remote repo spacecraft-aws-eks-anywhere-test-0bed5a33-d5ad-4e31-9136-7417857631a0-20 does not exist
2022-05-02T03:44:09.741Z	V3	e2e	Cleaning up long running container	{"name": "eksa_1651456677061889647"}
2022-05-02T03:44:09.835Z	V3	e2e	Logging out from current govc session
2022-05-02T03:44:10.525Z	V3	e2e	Cleaning up long running container	{"name": "eksa_1651456663045962179"}
--- FAIL: TestVSphereKubernetes122ThreeReplicasThreeWorkersFluxLegacy (6387.58s)
FAIL

DONE 1 tests, 1 failure in 6387.713s