2022-05-02T01:56:47.721Z	V4	e2e	Logger init completed	{"vlevel": 4}
=== RUN   TestVSphereKubernetes121BottlerocketTo122Upgrade
2022-05-02T01:56:47.721Z	V2	e2e	Pulling docker image	{"image": "public.ecr.aws/l0g8r8j6/eks-anywhere-cli-tools:v0.1.0-eks-a-v0.0.0-dev-build.589"}
2022-05-02T01:56:54.825Z	V3	e2e	Initializing long running container	{"name": "eksa_1651456607721639078", "image": "public.ecr.aws/l0g8r8j6/eks-anywhere-cli-tools:v0.1.0-eks-a-v0.0.0-dev-build.589"}
2022-05-02T01:56:59.222Z	V2	e2e	Pulling docker image	{"image": "public.ecr.aws/l0g8r8j6/eks-anywhere-cli-tools:v0.1.0-eks-a-v0.0.0-dev-build.589"}
2022-05-02T01:57:00.189Z	V3	e2e	Initializing long running container	{"name": "eksa_1651456619222693492", "image": "public.ecr.aws/l0g8r8j6/eks-anywhere-cli-tools:v0.1.0-eks-a-v0.0.0-dev-build.589"}
    cluster.go:499: Running shell command [ eksctl anywhere generate clusterconfig main-i-0b29b09d08a253d68 -p vsphere > cluster.yaml ]
    cluster.go:374: Creating cluster main-i-0b29b09d08a253d68
    cluster.go:499: Running shell command [ eksctl anywhere create cluster -f main-i-0b29b09d08a253d68-config/cluster.yaml -v 4 ]
2022-05-02T01:57:02.196Z	V4	Logger init completed	{"vlevel": 4}
2022-05-02T01:57:02.319Z	V0	Warning: VSphereDatacenterConfig configured in insecure mode
2022-05-02T01:57:02.364Z	V4	Reading bundles manifest	{"url": "https://dev-release-prod-pdx.s3.amazonaws.com/bundle-release.yaml"}
2022-05-02T01:57:02.453Z	V2	Pulling docker image	{"image": "public.ecr.aws/l0g8r8j6/eks-anywhere-cli-tools:v0.7.2-eks-a-v0.0.0-dev-build.1872"}
2022-05-02T01:57:08.422Z	V3	Initializing long running container	{"name": "eksa_1651456622453302958", "image": "public.ecr.aws/l0g8r8j6/eks-anywhere-cli-tools:v0.7.2-eks-a-v0.0.0-dev-build.1872"}
2022-05-02T01:57:11.508Z	V4	Task start	{"task_name": "setup-validate"}
2022-05-02T01:57:11.508Z	V0	Performing setup and validations
2022-05-02T01:57:11.509Z	V0	Warning: VSphereDatacenterConfig configured in insecure mode
2022-05-02T01:57:11.543Z	V0	✅ Connected to server
2022-05-02T01:57:11.852Z	V0	✅ Authenticated to vSphere
2022-05-02T01:57:12.226Z	V0	✅ Datacenter validated
2022-05-02T01:57:12.626Z	V0	✅ Network validated
2022-05-02T01:57:14.892Z	V0	✅ Datastore validated
2022-05-02T01:57:15.204Z	V0	✅ Folder validated
2022-05-02T01:57:15.524Z	V0	✅ Resource pool validated
2022-05-02T01:57:15.828Z	V0	✅ Datastore validated
2022-05-02T01:57:16.137Z	V0	✅ Folder validated
2022-05-02T01:57:16.463Z	V0	✅ Resource pool validated
2022-05-02T01:57:16.808Z	V0	✅ Datastore validated
2022-05-02T01:57:17.103Z	V0	✅ Folder validated
2022-05-02T01:57:17.414Z	V0	✅ Resource pool validated
2022-05-02T01:57:18.105Z	V0	✅ Control plane and Workload templates validated
2022-05-02T01:57:21.558Z	V0	✅ Vsphere Provider setup is valid
2022-05-02T01:57:21.558Z	V0	✅ Validate certificate for registry mirror
2022-05-02T01:57:21.558Z	V0	✅ Create preflight validations pass
2022-05-02T01:57:21.559Z	V4	Task finished	{"task_name": "setup-validate", "duration": "10.050084343s"}
2022-05-02T01:57:21.559Z	V4	----------------------------------
2022-05-02T01:57:21.559Z	V4	Task start	{"task_name": "bootstrap-cluster-init"}
2022-05-02T01:57:21.559Z	V0	Creating new bootstrap cluster
2022-05-02T01:57:21.559Z	V4	Creating kind cluster	{"name": "main-i-0b29b09d08a253d68-eks-a-cluster", "kubeconfig": "main-i-0b29b09d08a253d68/generated/main-i-0b29b09d08a253d68.kind.kubeconfig"}
2022-05-02T01:58:26.703Z	V0	Provider specific pre-capi-install-setup on bootstrap cluster
2022-05-02T01:58:26.703Z	V0	Installing cluster-api providers on bootstrap cluster
2022-05-02T01:59:35.832Z	V0	Provider specific post-setup
2022-05-02T01:59:35.832Z	V4	Task finished	{"task_name": "bootstrap-cluster-init", "duration": "2m14.273006672s"}
2022-05-02T01:59:35.832Z	V4	----------------------------------
2022-05-02T01:59:35.832Z	V4	Task start	{"task_name": "workload-cluster-init"}
2022-05-02T01:59:35.832Z	V0	Creating new workload cluster
2022-05-02T01:59:38.304Z	V3	Waiting for external etcd to be ready	{"cluster": "main-i-0b29b09d08a253d68"}
2022-05-02T02:02:30.560Z	V3	External etcd is ready
2022-05-02T02:02:30.560Z	V3	Waiting for control plane to be ready
2022-05-02T02:06:19.574Z	V3	Waiting for workload kubeconfig generation	{"cluster": "main-i-0b29b09d08a253d68"}
2022-05-02T02:06:19.931Z	V3	Waiting for controlplane and worker machines to be ready
2022-05-02T02:06:20.258Z	V4	Nodes are not ready yet	{"total": 4, "ready": 3, "cluster name": "main-i-0b29b09d08a253d68"}
2022-05-02T02:06:20.608Z	V4	Nodes are not ready yet	{"total": 4, "ready": 3, "cluster name": "main-i-0b29b09d08a253d68"}
2022-05-02T02:06:21.938Z	V4	Nodes are not ready yet	{"total": 4, "ready": 3, "cluster name": "main-i-0b29b09d08a253d68"}
2022-05-02T02:06:23.293Z	V4	Nodes are not ready yet	{"total": 4, "ready": 3, "cluster name": "main-i-0b29b09d08a253d68"}
2022-05-02T02:06:24.614Z	V4	Nodes are not ready yet	{"total": 4, "ready": 3, "cluster name": "main-i-0b29b09d08a253d68"}
2022-05-02T02:06:25.944Z	V4	Nodes are not ready yet	{"total": 4, "ready": 3, "cluster name": "main-i-0b29b09d08a253d68"}
2022-05-02T02:06:27.343Z	V4	Nodes are not ready yet	{"total": 4, "ready": 3, "cluster name": "main-i-0b29b09d08a253d68"}
2022-05-02T02:06:28.759Z	V4	Nodes are not ready yet	{"total": 4, "ready": 3, "cluster name": "main-i-0b29b09d08a253d68"}
2022-05-02T02:06:30.101Z	V4	Nodes ready	{"total": 4}
2022-05-02T02:06:30.101Z	V0	Installing networking on workload cluster
2022-05-02T02:06:33.682Z	V0	Installing storage class on cluster
2022-05-02T02:06:34.245Z	V0	Installing cluster-api providers on workload cluster
2022-05-02T02:08:23.571Z	V0	Installing EKS-A secrets on workload cluster
2022-05-02T02:08:27.564Z	V4	Installing machine health checks on bootstrap cluster
2022-05-02T02:08:28.118Z	V4	Task finished	{"task_name": "workload-cluster-init", "duration": "8m52.286564453s"}
2022-05-02T02:08:28.118Z	V4	----------------------------------
2022-05-02T02:08:28.118Z	V4	Task start	{"task_name": "capi-management-move"}
2022-05-02T02:08:28.118Z	V0	Moving cluster management from bootstrap to workload cluster
2022-05-02T02:08:28.118Z	V3	Waiting for management machines to be ready before move
2022-05-02T02:08:28.455Z	V4	Nodes ready	{"total": 4}
2022-05-02T02:08:47.887Z	V3	Waiting for control planes to be ready after move
2022-05-02T02:08:58.321Z	V3	Waiting for workload cluster control plane replicas to be ready after move
2022-05-02T02:08:58.954Z	V3	Waiting for workload cluster machine deployment replicas to be ready after move
2022-05-02T02:08:59.482Z	V3	Waiting for machines to be ready after move
2022-05-02T02:08:59.853Z	V4	Nodes ready	{"total": 4}
2022-05-02T02:08:59.853Z	V4	Task finished	{"task_name": "capi-management-move", "duration": "31.734799477s"}
2022-05-02T02:08:59.853Z	V4	----------------------------------
2022-05-02T02:08:59.853Z	V4	Task start	{"task_name": "eksa-components-install"}
2022-05-02T02:08:59.853Z	V0	Installing EKS-A custom components (CRD and controller) on workload cluster
2022-05-02T02:09:28.982Z	V0	Installing EKS-D components on workload cluster
2022-05-02T02:09:32.211Z	V0	Creating EKS-A CRDs instances on workload cluster
2022-05-02T02:09:32.214Z	V4	Applying eksa yaml resources to cluster
2022-05-02T02:09:33.537Z	V1	Applying Bundles to cluster
2022-05-02T02:09:34.527Z	V4	Applying eksd manifest to cluster
2022-05-02T02:09:38.492Z	V4	Task finished	{"task_name": "eksa-components-install", "duration": "38.638602487s"}
2022-05-02T02:09:38.492Z	V4	----------------------------------
2022-05-02T02:09:38.492Z	V4	Task start	{"task_name": "addon-manager-install"}
2022-05-02T02:09:38.492Z	V0	Installing AddonManager and GitOps Toolkit on workload cluster
2022-05-02T02:09:38.492Z	V0	GitOps field not specified, bootstrap flux skipped
2022-05-02T02:09:38.492Z	V4	Task finished	{"task_name": "addon-manager-install", "duration": "13.701µs"}
2022-05-02T02:09:38.492Z	V4	----------------------------------
2022-05-02T02:09:38.492Z	V4	Task start	{"task_name": "write-cluster-config"}
2022-05-02T02:09:38.492Z	V0	Writing cluster config file
2022-05-02T02:09:38.495Z	V4	Task finished	{"task_name": "write-cluster-config", "duration": "3.385828ms"}
2022-05-02T02:09:38.495Z	V4	----------------------------------
2022-05-02T02:09:38.495Z	V4	Task start	{"task_name": "delete-kind-cluster"}
2022-05-02T02:09:38.495Z	V0	Deleting bootstrap cluster
2022-05-02T02:09:39.728Z	V4	Deleting kind cluster	{"name": "main-i-0b29b09d08a253d68-eks-a-cluster"}
2022-05-02T02:09:41.375Z	V0	🎉 Cluster created!
2022-05-02T02:09:41.375Z	V4	Task finished	{"task_name": "delete-kind-cluster", "duration": "2.879421289s"}
2022-05-02T02:09:41.375Z	V4	----------------------------------
2022-05-02T02:09:41.375Z	V4	Tasks completed	{"duration": "12m29.86621772s"}
2022-05-02T02:09:41.376Z	V3	Logging out from current govc session
2022-05-02T02:09:42.031Z	V3	Cleaning up long running container	{"name": "eksa_1651456622453302958"}
    cluster.go:499: Running shell command [ eksctl anywhere upgrade cluster -f main-i-0b29b09d08a253d68-config/cluster.yaml -v 4 ]
2022-05-02T02:09:42.234Z	V4	Logger init completed	{"vlevel": 4}
2022-05-02T02:09:42.325Z	V0	Warning: VSphereDatacenterConfig configured in insecure mode
2022-05-02T02:09:42.367Z	V4	Reading bundles manifest	{"url": "https://dev-release-prod-pdx.s3.amazonaws.com/bundle-release.yaml"}
2022-05-02T02:09:42.452Z	V2	Pulling docker image	{"image": "public.ecr.aws/l0g8r8j6/eks-anywhere-cli-tools:v0.7.2-eks-a-v0.0.0-dev-build.1872"}
2022-05-02T02:09:43.413Z	V3	Initializing long running container	{"name": "eksa_1651457382452097885", "image": "public.ecr.aws/l0g8r8j6/eks-anywhere-cli-tools:v0.7.2-eks-a-v0.0.0-dev-build.1872"}
2022-05-02T02:09:43.762Z	V4	Task start	{"task_name": "setup-and-validate"}
2022-05-02T02:09:43.762Z	V0	Performing setup and validations
2022-05-02T02:09:43.762Z	V0	Warning: VSphereDatacenterConfig configured in insecure mode
2022-05-02T02:09:43.807Z	V0	✅ Connected to server
2022-05-02T02:09:44.139Z	V0	✅ Authenticated to vSphere
2022-05-02T02:09:44.798Z	V0	✅ Datacenter validated
2022-05-02T02:09:45.319Z	V0	✅ Network validated
2022-05-02T02:09:48.587Z	V0	✅ Datastore validated
2022-05-02T02:09:49.056Z	V0	✅ Folder validated
2022-05-02T02:09:49.526Z	V0	✅ Resource pool validated
2022-05-02T02:09:49.996Z	V0	✅ Datastore validated
2022-05-02T02:09:50.485Z	V0	✅ Folder validated
2022-05-02T02:09:50.997Z	V0	✅ Resource pool validated
2022-05-02T02:09:51.543Z	V0	✅ Datastore validated
2022-05-02T02:09:52.039Z	V0	✅ Folder validated
2022-05-02T02:09:52.470Z	V0	✅ Resource pool validated
2022-05-02T02:09:53.463Z	V1	Control plane template validation failed.
2022-05-02T02:09:53.463Z	V0	❌ Validation failed	{"validation": "vsphere Provider setup is valid", "error": "template /SDDC-Datacenter/vm/Templates/bottlerocket-kube-v1-22 is missing tag eksdRelease:kubernetes-1-22-eks-6", "remediation": ""}
2022-05-02T02:09:57.861Z	V3	calculating version differences	{"inputVersion": "1.22", "clusterVersion": "1.21.9-eks-bbc8a0c"}
2022-05-02T02:09:57.861Z	V3	calculated version differences	{"majorVersionDifference": 0, "minorVersionDifference": 1}
2022-05-02T02:10:01.683Z	V0	✅ Validate certificate for registry mirror
2022-05-02T02:10:01.683Z	V0	✅ Control plane ready
2022-05-02T02:10:01.683Z	V0	✅ Worker nodes ready
2022-05-02T02:10:01.683Z	V0	✅ Nodes ready
2022-05-02T02:10:01.683Z	V0	✅ Cluster CRDs ready
2022-05-02T02:10:01.683Z	V0	✅ Cluster object present on workload cluster
2022-05-02T02:10:01.683Z	V0	✅ Upgrade cluster kubernetes version increment
2022-05-02T02:10:01.683Z	V0	✅ Validate immutable fields
2022-05-02T02:10:01.683Z	V0	✅ Upgrade preflight validations pass
2022-05-02T02:10:01.683Z	V4	Task finished	{"task_name": "setup-and-validate", "duration": "17.920808069s"}
2022-05-02T02:10:01.683Z	V4	----------------------------------
2022-05-02T02:10:01.683Z	V4	Tasks completed	{"duration": "17.920856305s"}
2022-05-02T02:10:01.683Z	V3	Logging out from current govc session
2022-05-02T02:10:02.444Z	V3	Cleaning up long running container	{"name": "eksa_1651457382452097885"}
Error: failed to upgrade cluster: validations failed
    cluster.go:532: Command eksctl anywhere [upgrade cluster -f main-i-0b29b09d08a253d68-config/cluster.yaml -v 4] failed with error: exit status 255: Error: failed to upgrade cluster: validations failed
2022-05-02T02:10:02.570Z	V3	e2e	Cleaning up long running container	{"name": "eksa_1651456619222693492"}
2022-05-02T02:10:02.652Z	V3	e2e	Logging out from current govc session
2022-05-02T02:10:03.350Z	V3	e2e	Cleaning up long running container	{"name": "eksa_1651456607721639078"}
--- FAIL: TestVSphereKubernetes121BottlerocketTo122Upgrade (795.73s)
FAIL

DONE 1 tests, 1 failure in 795.800s