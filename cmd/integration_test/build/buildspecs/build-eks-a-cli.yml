version: 0.2

phases:
  build:
    commands:
    - make -j $(nproc) build-eks-a-for-e2e build-integration-test-binary e2e-test-provider-binaries
    - echo "$CODEBUILD_RESOLVED_SOURCE_VERSION" >> bin/githash
    - >
      ./cmd/integration_test/build/script/upload_artifacts.sh
      $ARTIFACTS_BUCKET
      $CODEBUILD_SRC_DIR
      "eks-a-cli"
      $CODEBUILD_BUILD_NUMBER
      $CODEBUILD_RESOLVED_SOURCE_VERSION
      "linux,darwin"
      "amd64,arm64"
      $BRANCH_NAME
      false
cache:
  paths:
    - '/root/.cache/go-build/**/*'
    - '/go/pkg/mod/**/*'

artifacts:
  files:
  - "bin/**/*"
  - "cmd/integration_test/build/**/*"
  - "test/e2e/SKIPPED_TESTS.yaml"
  - "ATTRIBUTION.txt"